!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e():t.WispNavigate=e()}("undefined"!=typeof window?window:this,function(){class t{static config={navigationProgressBar:!0,navigationProgressBarColor:"#29d",navigationProgressBarHeight:"3px",enablePerformanceLogging:!1};static init(t={}){this.config={...this.config,...t},this.bindNavigation(),window.addEventListener("popstate",()=>{this.navigate(window.location.pathname+window.location.search,{pushState:!1})})}static bindNavigation(){document.querySelectorAll("a[wisp\\:navigate], a[wisp-navigate]").forEach(t=>{t.removeEventListener("click",this.handleNavigate),t.addEventListener("click",this.handleNavigate)})}static handleNavigate=t=>{t.preventDefault();let e=t.currentTarget.getAttribute("href");e&&"#"!==e&&this.navigate(e)};static async navigate(t,e={pushState:!0}){let i=new CustomEvent("wisp:navigate-before",{cancelable:!0,detail:{url:t,options:e}}),a=document.dispatchEvent(i);if(a)try{let n=performance.now();document.dispatchEvent(new CustomEvent("wisp:navigate-start",{detail:{url:t,options:e}})),this.showNavigationProgressBar();let r=await fetch(t,{headers:{"X-Requested-With":"X-Wisp-Navigate",Accept:"text/html"}});if(!r.ok)throw Error(`Navigation failed: ${r.status}`);let s=await r.text(),o=new DOMParser,g=o.parseFromString(s,"text/html");document.dispatchEvent(new CustomEvent("wisp:navigate-before-dom-update",{detail:{url:t,options:e,newDocument:g}}));let c=g.querySelector("#app"),l=document.querySelector("#app");if(c&&l?l.innerHTML=c.innerHTML:document.body.innerHTML=g.body.innerHTML,document.title=g.title,document.dispatchEvent(new CustomEvent("wisp:navigate-after-dom-update",{detail:{url:t,options:e}})),this.config.enablePerformanceLogging){let d=performance.now()-n;console.debug(`WispNavigate took ${d.toFixed(2)}ms`)}this.bindNavigation(),window.scrollTo(0,0),!1!==e.pushState&&window.history.pushState({},"",t),document.dispatchEvent(new CustomEvent("wisp:navigate-success",{detail:{url:t,options:e}}))}catch(p){console.error("Navigation error:",p),document.dispatchEvent(new CustomEvent("wisp:navigate-error",{detail:{url:t,options:e,error:p}})),window.location.href=t}finally{this.hideNavigationProgressBar(),document.dispatchEvent(new CustomEvent("wisp:navigate-complete",{detail:{url:t,options:e}}))}}static showNavigationProgressBar(){if(!this.config.navigationProgressBar)return;this.injectNavigationProgressBar();let t=document.getElementById("wisp-progress-bar");t&&(t.style.opacity="1",t.style.width="0",setTimeout(()=>{t.style.width="80%"},10))}static hideNavigationProgressBar(){if(!this.config.navigationProgressBar)return;let t=document.getElementById("wisp-progress-bar");t&&(t.style.width="100%",setTimeout(()=>{t.style.opacity="0",t.style.width="0"},400))}static injectNavigationProgressBar(){if(document.getElementById("wisp-progress-bar"))return;let t=document.createElement("div");t.id="wisp-progress-bar";let e=this.config.navigationProgressBarColor||"#29d",i=this.config.navigationProgressBarHeight||"3px";t.style.cssText=`position:fixed;top:0;left:0;height:${i};width:0;background:${e};z-index:99999;transition:width 0.2s,opacity 0.4s;opacity:0;`,document.body.appendChild(t)}}return document.addEventListener("DOMContentLoaded",()=>t.init({navigationProgressBar:!0,navigationProgressBarColor:"#29d",navigationProgressBarHeight:"3px",enablePerformanceLogging:!0})),t});
