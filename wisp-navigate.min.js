!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e():t.WispNavigate=e()}("undefined"!=typeof window?window:this,(function(){class t{static config={navigationProgressBar:!0,navigationProgressBarColor:"#29d",navigationProgressBarHeight:"3px",enablePerformanceLogging:!1,enablePrefetchOnHover:!0,enablePrefetchOnView:!0,prefetchDelay:150};static#t=null;static#e=!1;static#i=new Map;static#a=null;static#o=null;static init(t={}){this.config={...this.config,...t},this.bindNavigation(),window.addEventListener("popstate",(()=>{this.navigate(window.location.pathname+window.location.search,{pushState:!1})}))}static bindNavigation(){this.#e||(this.#e=!0,document.addEventListener("click",(t=>{const e=t.target.closest("a[wisp\\:navigate], a[wisp-navigate]");if(!e)return;const i=e.getAttribute("href");this.#s(i,e)&&(t.preventDefault(),this.handleNavigate(i))}),{capture:!1,passive:!1}),this.config.enablePrefetchOnHover&&(document.addEventListener("mouseover",(t=>{const e=t.target.closest("a[wisp\\:navigate], a[wisp-navigate]");if(!e)return;const i=e.getAttribute("href");this.#s(i,e)&&(clearTimeout(this.#a),this.#a=setTimeout((()=>{this.prefetch(i)}),this.config.prefetchDelay))}),{capture:!1,passive:!0}),document.addEventListener("mouseout",(()=>{clearTimeout(this.#a)}),{passive:!0})),this.config.enablePrefetchOnView&&(this.#o&&this.#o.disconnect(),this.#o=new IntersectionObserver((t=>{for(const e of t)if(e.isIntersecting){const t=e.target,i=t.getAttribute("href");this.#s(i,t)&&this.prefetch(i),this.#o.unobserve(t)}}),{rootMargin:"200px"}),document.querySelectorAll("a[wisp\\:navigate], a[wisp-navigate]").forEach((t=>{const e=t.getAttribute("href");this.#s(e,t)&&this.#o.observe(t)}))))}static handleNavigate(t){t&&(this.#i.has(t)?this.#n(t):this.navigate(t))}static async navigate(t,e={pushState:!0}){const i=new CustomEvent("wisp:navigate-before",{cancelable:!0,detail:{url:t,options:e}});if(document.dispatchEvent(i)){this.#t&&this.#t.abort(),this.#t=new AbortController;try{const i=performance.now();document.dispatchEvent(new CustomEvent("wisp:navigate-start",{detail:{url:t,options:e}})),this.showNavigationProgressBar();const a=await fetch(t,{headers:{"X-Requested-With":"X-Wisp-Navigate",Accept:"text/html"},signal:this.#t.signal});if(!a.ok)throw new Error(`Navigation failed: ${a.status} ${a.statusText}`);const o=await a.text();if(this.#r(o,t,e),this.config.enablePerformanceLogging){const t=performance.now()-i;console.debug(`[WispNavigate] Navigation took ${t.toFixed(2)}ms`)}if(!1!==e.pushState)try{window.history.pushState({},"",t)}catch(t){console.warn("[WispNavigate] pushState failed:",t)}document.dispatchEvent(new CustomEvent("wisp:navigate-success",{detail:{url:t,options:e}}))}catch(i){if("AbortError"===i.name)return void console.info("[WispNavigate] Navigation aborted");console.error("[WispNavigate] Navigation error:",i,i.stack),document.dispatchEvent(new CustomEvent("wisp:navigate-error",{detail:{url:t,options:e,error:i}})),window.location.href=t}finally{this.hideNavigationProgressBar(),document.dispatchEvent(new CustomEvent("wisp:navigate-complete",{detail:{url:t,options:e}}))}}}static async prefetch(t){if(!this.#i.has(t))try{const e=await fetch(t,{headers:{"X-Requested-With":"X-Wisp-Navigate",Accept:"text/html"}});if(!e.ok)return;const i=await e.text();this.#i.set(t,i)}catch(e){console.debug("[WispNavigate] Prefetch failed for",t,e)}}static#n(t){const e=this.#i.get(t);if(e){this.#r(e,t,{pushState:!0});try{window.history.pushState({},"",t)}catch(t){console.warn("[WispNavigate] pushState failed:",t)}document.dispatchEvent(new CustomEvent("wisp:navigate-success",{detail:{url:t,options:{pushState:!0},prefetched:!0}}))}}static#r(t,e,i){const a=(new DOMParser).parseFromString(t,"text/html");document.dispatchEvent(new CustomEvent("wisp:navigate-before-dom-update",{detail:{url:e,options:i,newDocument:a}}));const o=a.querySelector("#app"),s=document.querySelector("#app");o&&s?s.innerHTML=o.innerHTML:document.body.innerHTML=a.body.innerHTML,document.title=a.title,document.dispatchEvent(new CustomEvent("wisp:navigate-after-dom-update",{detail:{url:e,options:i}})),this.#e=!1,this.bindNavigation(),window.scrollTo(0,0)}static#s(t,e){return!!t&&"#"!==t&&"_blank"!==e.target&&!t.startsWith("mailto:")&&!t.startsWith("tel:")&&(!/^(https?:)?\/\//.test(t)||t.startsWith(location.origin))}static showNavigationProgressBar(){if(!this.config.navigationProgressBar)return;this.injectNavigationProgressBar();const t=document.getElementById("wisp-progress-bar");t&&(t.style.opacity="1",t.style.width="0",setTimeout((()=>{t.style.width="80%"}),10))}static hideNavigationProgressBar(){if(!this.config.navigationProgressBar)return;const t=document.getElementById("wisp-progress-bar");t&&(t.style.width="100%",setTimeout((()=>{t.style.opacity="0",t.style.width="0"}),400))}static injectNavigationProgressBar(){if(document.getElementById("wisp-progress-bar"))return;if(!document.body)return void console.warn("[WispNavigate] Cannot inject progress bar - document.body not ready");const t=document.createElement("div");t.id="wisp-progress-bar";const e=this.config.navigationProgressBarColor||"#29d",i=this.config.navigationProgressBarHeight||"3px";t.style.cssText=`\n                position:fixed;top:0;left:0;height:${i};width:0;\n                background:${e};z-index:99999;transition:width 0.2s,opacity 0.4s;\n                opacity:0;\n            `,document.body.appendChild(t)}}return t}));
